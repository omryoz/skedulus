<?php 
class Home_model extends CI_Model {
 
	function insertinfo(){
		$insertArray=array();
		if(isset($_POST['firstname']))$insertArray['first_name']= $_POST['firstname'];
		if(isset($_POST['lastname']))$insertArray['last_name']= $_POST['lastname'];
		if(isset($_POST['month']) && isset($_POST['year']) && isset($_POST['day'])){
		$dob = $_POST['year'].'-'.$_POST['month'].'-'.$_POST['day'];
		$insertArray['date_of_birth']= date('y-m-d',strtotime($dob));
		}
		if(isset($_POST['email']))$insertArray['email']= $_POST['email'];
		if(isset($_POST['gender']))$insertArray['gender']= $_POST['gender']; 
		if(isset($_POST['password']))$insertArray['password']= MD5($_POST['password']);
		$insertArray['createdOn']= date("Y-m-d H:i:s");
		
		if($_POST['usertype']=='businessSignUp'){ 
		$insertArray['user_role']= 'manager';
		$insertArray['status']= 'inactive';
		$insertArray['activationkey']= MD5($_POST['email'].time());
		}elseif($_POST['usertype']=='clientSignUp'){
		$insertArray['user_role']= 'client';
		$insertArray['status']= 'active';
		$insertArray['activationkey']="0";
		//Set session 
		$id=mysql_insert_id();
			 $sessionVal=array(
			 'id'=>$id,
			 'username'=>$_POST['firstname'],
			 'email'=>$_POST['email']
		 );
		 $this->session->set_userdata($sessionVal);
		
		}
		$this->db->insert('users',$insertArray);
		if($_POST['usertype']=='businessSignUp'){
		$id=mysql_insert_id();
		return $id;
		}else{
		return true;
		}
	}
	
	function updateUser(){
	$status=$this->common_model->getRow("users","activationkey",$_GET[activation_link]);
	if($status->status=='active'){
	$val="alreadyUser";
	}else{
	$sql=mysql_query("update users set status='active' where activationkey='$_GET[activation_link]'");
	   $sessionVal=array(
			 'id'=>$status->id,
			 'username'=>$status->first_name,
			 'email'=>$status->email
		 );
		 $this->session->set_userdata($sessionVal);	
	$val="newUser";
	}
	 return $val;
	}
}
?>